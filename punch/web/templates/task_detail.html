{% extends "base.html" %}
{% block title %}Task #{{ task.id }} - Punch{% endblock %}
{% block content %}
<div class="space-y-6">
    <div class="flex items-center space-x-4">
        <a href="/tasks" class="text-gray-400 hover:text-white">&larr; Back</a>
        <h2 class="text-2xl font-bold">Task #{{ task.id }}</h2>
        <span class="text-xs px-2 py-1 rounded-full
            {% if task.status == 'running' %}bg-yellow-900/50 text-yellow-400
            {% elif task.status == 'completed' %}bg-green-900/50 text-green-400
            {% elif task.status == 'failed' %}bg-red-900/50 text-red-400
            {% else %}bg-gray-800 text-gray-400{% endif %}">{{ task.status }}</span>
    </div>
    <div class="bg-gray-900 rounded-lg p-6 border border-gray-800">
        <div class="grid grid-cols-2 gap-4 text-sm mb-6">
            <div><span class="text-gray-400">Agent:</span> {{ task.agent_type }}</div>
            <div><span class="text-gray-400">Source:</span> {{ task.source }}</div>
            <div><span class="text-gray-400">Created:</span> {{ task.created_at }}</div>
            <div><span class="text-gray-400">Completed:</span> {{ task.completed_at or "-" }}</div>
        </div>
        <div class="mb-4">
            <h3 class="text-sm text-gray-400 mb-2">Prompt</h3>
            <pre class="bg-gray-800 rounded p-4 text-sm whitespace-pre-wrap">{{ task.prompt }}</pre>
        </div>
        {% if task.result %}
        <div class="mb-4">
            <h3 class="text-sm text-gray-400 mb-2">Result</h3>
            <pre class="bg-gray-800 rounded p-4 text-sm whitespace-pre-wrap">{{ task.result }}</pre>
        </div>
        {% endif %}
        {% if task.error %}
        <div class="mb-4">
            <h3 class="text-sm text-red-400 mb-2">Error</h3>
            <pre class="bg-red-900/20 rounded p-4 text-sm whitespace-pre-wrap text-red-300">{{ task.error }}</pre>
        </div>
        {% endif %}
    </div>
    {% if conversation %}
    <div>
        <h3 class="text-lg font-semibold mb-4">Conversation Log</h3>
        <div class="space-y-3">
            {% for msg in conversation %}
            <div class="bg-gray-900 rounded-lg p-4 border border-gray-800">
                <div class="text-xs text-gray-500 mb-2">{{ msg.role }} &middot; {{ msg.created_at }}</div>
                <pre class="text-sm whitespace-pre-wrap">{{ msg.content }}</pre>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
