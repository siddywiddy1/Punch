{% extends "base.html" %}
{% block title %}{{ chat.title }} - Punch Chat{% endblock %}
{% block content %}
<div class="-m-6 flex h-[calc(100vh)] max-w-none">
    <!-- Chat Sidebar -->
    <div class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col flex-shrink-0">
        <div class="p-3 border-b border-gray-800">
            <button hx-post="/htmx/chat/new" hx-swap="none"
                    class="w-full px-3 py-2 bg-punch-600 hover:bg-punch-700 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                New Chat
            </button>
        </div>
        <div class="flex-1 overflow-y-auto py-2">
            {% for c in chats %}
            <a href="/chat/{{ c.id }}"
               class="block px-3 py-2 mx-2 rounded-lg text-sm truncate {% if c.id == chat.id %}bg-gray-800 text-punch-400{% else %}text-gray-400 hover:bg-gray-800/50 hover:text-gray-200{% endif %} transition-colors">
                {{ c.title }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Chat Main Area -->
    <div class="flex-1 flex flex-col min-w-0">
        <!-- Chat Header -->
        <div class="px-6 py-3 border-b border-gray-800 flex items-center justify-between flex-shrink-0">
            <h2 class="text-lg font-semibold truncate">{{ chat.title }}</h2>
            <button hx-delete="/htmx/chat/{{ chat.id }}" hx-swap="none"
                    hx-confirm="Delete this chat?"
                    class="text-gray-500 hover:text-red-400 transition-colors p-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
            </button>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages" class="flex-1 overflow-y-auto px-6 py-4"
             hx-get="/htmx/chat/{{ chat.id }}/messages"
             hx-trigger="every 2s [document.querySelector('[data-pending]') !== null]"
             hx-swap="innerHTML">
            {% include "partials/chat_messages.html" %}
        </div>

        <!-- Input Bar -->
        <div class="px-6 py-4 border-t border-gray-800 flex-shrink-0">
            <form hx-post="/htmx/chat/{{ chat.id }}/send"
                  hx-target="#chat-messages"
                  hx-swap="innerHTML"
                  hx-on::after-request="this.reset(); setTimeout(() => { const el = document.getElementById('chat-messages'); el.scrollTop = el.scrollHeight; }, 50)"
                  class="flex gap-3">
                <input type="text" name="message" placeholder="Message Punch..."
                       autocomplete="off" required
                       class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-punch-500 focus:ring-1 focus:ring-punch-500 transition-colors">
                <button type="submit"
                        class="px-6 py-3 bg-punch-600 hover:bg-punch-700 rounded-lg text-sm font-medium transition-colors flex-shrink-0">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>
<script>
    // Auto-scroll to bottom on page load
    const chatEl = document.getElementById('chat-messages');
    if (chatEl) chatEl.scrollTop = chatEl.scrollHeight;
</script>
{% endblock %}
